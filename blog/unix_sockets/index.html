<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.105.0"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Sockets | hartje.io</title><meta name=description content="Summary If you&amp;rsquo;ve ever used netstat, or gone to a website on OSX or Linux (or Windows for that matter) without a background in C (or perhaps systems programming), you may have struggled to fully appreciate the content there in. Or maybe you are just curious to know how sockets work in *nix.
sockets are a form of IPC, or inter process communication, allowing processes to bidirectionally share information with other processes."><meta property="og:title" content="Sockets"><meta property="og:description" content="Summary If you&rsquo;ve ever used netstat, or gone to a website on OSX or Linux (or Windows for that matter) without a background in C (or perhaps systems programming), you may have struggled to fully appreciate the content there in. Or maybe you are just curious to know how sockets work in *nix.
sockets are a form of IPC, or inter process communication, allowing processes to bidirectionally share information with other processes."><meta property="og:type" content="article"><meta property="og:url" content="https://hartje.io/blog/unix_sockets/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-03-04T10:44:43-06:00"><meta property="article:modified_time" content="2022-03-04T10:44:43-06:00"><meta itemprop=name content="Sockets"><meta itemprop=description content="Summary If you&rsquo;ve ever used netstat, or gone to a website on OSX or Linux (or Windows for that matter) without a background in C (or perhaps systems programming), you may have struggled to fully appreciate the content there in. Or maybe you are just curious to know how sockets work in *nix.
sockets are a form of IPC, or inter process communication, allowing processes to bidirectionally share information with other processes."><meta itemprop=datePublished content="2022-03-04T10:44:43-06:00"><meta itemprop=dateModified content="2022-03-04T10:44:43-06:00"><meta itemprop=wordCount content="513"><meta itemprop=keywords content="C,Unix,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Sockets"><meta name=twitter:description content="Summary If you&rsquo;ve ever used netstat, or gone to a website on OSX or Linux (or Windows for that matter) without a background in C (or perhaps systems programming), you may have struggled to fully appreciate the content there in. Or maybe you are just curious to know how sockets work in *nix.
sockets are a form of IPC, or inter process communication, allowing processes to bidirectionally share information with other processes."><link rel=preload href=/scss/main.min.e1bc7e4becb010b3f0707443124174a92732525d1a2b80cd7fb0f53df44a30fc.css as=style><link href=/scss/main.min.e1bc7e4becb010b3f0707443124174a92732525d1a2b80cd7fb0f53df44a30fc.css rel=stylesheet integrity><link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css rel=stylesheet><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script></head><body class="td-page td-blog"><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo></span><span class=font-weight-bold>hartje.io</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-blog-li><a href=/blog/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-blog><span>Blogs</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogk6-li><a href=/blog/k6/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blogk6><span>K6</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghomelab-li><a href=/blog/homelab/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-bloghomelab><span>Homelab</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-blogunix_sockets-li><a href=/blog/unix_sockets/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-blogunix_sockets><span class=td-sidebar-nav-active-item>Sockets</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghugo-li><a href=/blog/hugo/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-bloghugo><span>Hugo</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#summary>Summary</a><ul><li><a href=#unix-socket-example>Unix Socket Example</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></div><div class="taxonomy taxonomy-terms-cloud taxo-tags"><h5 class=taxonomy-title>Tags</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://hartje.io/tags/c/ data-taxonomy-term=c><span class=taxonomy-label>C</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://hartje.io/tags/testing/ data-taxonomy-term=testing><span class=taxonomy-label>testing</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://hartje.io/tags/unix/ data-taxonomy-term=unix><span class=taxonomy-label>Unix</span><span class=taxonomy-count>1</span></a></li></ul></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role=main><a class=td-rss-button title=RSS href=https://hartje.io/blog/index.xml target=_blank rel=noopener><i class="fa-solid fa-rss" aria-hidden=true></i></a><div class=td-content><h1>Sockets</h1><div class="td-byline mb-4"><time datetime=2022-03-04 class=text-muted>Friday, March 04, 2022</time></div><header class=article-meta><div class="taxonomy taxonomy-terms-article taxo-tags"><h5 class=taxonomy-title>Tags:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://hartje.io/tags/c/ data-taxonomy-term=c><span class=taxonomy-label>C</span></a></li><li><a class=taxonomy-term href=https://hartje.io/tags/unix/ data-taxonomy-term=unix><span class=taxonomy-label>Unix</span></a></li></ul></div></header><h2 id=summary>Summary</h2><p>If you&rsquo;ve ever used <code>netstat</code>, or gone to a website on OSX or Linux (or Windows for that matter) without a background in C (or perhaps systems programming), you may have struggled to fully appreciate the content there in. Or maybe you are just curious to know how <code>sockets</code> work in *nix.</p><p><code>sockets</code> are a form of <code>IPC</code>, or inter process communication, allowing processes to bidirectionally share information with other processes. See other kinds of IPC in <a href=https://beej.us/guide/bgipc/html/multi/index.html>Beej&rsquo;s Guide to Unix IPC</a>.</p><p><code>sockets</code> are commonly referred to by their <em>Address Family</em>, seen in constants such as <code>AF_UNIX</code>, or <code>AF_LOCAL</code>, representing local sockets specifically. You might also want to know about <em>Protocol Family</em>, seen in constants such as <code>PF_UNIX</code> and <code>PF_LOCAL</code>.</p><p>Valid <code>socket</code> types that should be known are:</p><table><thead><tr><th>type</th><th>description</th></tr></thead><tbody><tr><td><code>SOCK_STREAM</code></td><td>A stream oriented packet used for TCP</td></tr><tr><td><code>SOCK_DGRAM</code></td><td>datagram oriented packet, no reordering, used for UDP</td></tr><tr><td><code>SOCK_RAW</code></td><td>Provides access to internal network protocols and interfaces. Only available to super-user</td></tr><tr><td><code>SOCK_SEQPACKET</code></td><td>A sequence-packet socket that is connection oriented, delivering messages in the order sent</td></tr></tbody></table><p>You can learn more about various types of valid <code>sockets</code> on the man page for the socket SystemCall:</p><p><a href=https://man7.org/linux/man-pages/man2/socket.2.html>https://man7.org/linux/man-pages/man2/socket.2.html</a></p><p>Now that we&rsquo;ve discussed what <code>sockets</code> are, and some of the well known constants that sockets use, let&rsquo;s look at the example in the man page.</p><h3 id=unix-socket-example>Unix Socket Example</h3><p>The given snippet in the man page is a bit terse, but practical:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>       <span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/socket.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>       <span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/un.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>       unix_socket <span style=color:#f92672>=</span> socket(AF_UNIX, type, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>       error <span style=color:#f92672>=</span> socketpair(AF_UNIX, type, <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>sv);
</span></span></code></pre></div><p>In the example above, we import the definitions for socket and unix domain sockets, then construct a unix_socket, and assign error the exit code of calling <code>socketpair</code>.</p><p>It is helpful to consult the manual, let&rsquo;s take a look at the two syscall signatures from their respective man pages:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>socket</span>(<span style=color:#66d9ef>int</span> domain, <span style=color:#66d9ef>int</span> type, <span style=color:#66d9ef>int</span> protocol);
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>socketpair</span>(<span style=color:#66d9ef>int</span> domain, <span style=color:#66d9ef>int</span> type, <span style=color:#66d9ef>int</span> protocol, <span style=color:#66d9ef>int</span> sv[<span style=color:#ae81ff>2</span>]);
</span></span></code></pre></div><ul><li><a href=https://man7.org/linux/man-pages/man2/socket.2.html>socket</a></li><li><a href=https://man7.org/linux/man-pages/man2/socketpair.2.html>socketpair</a></li></ul><p>Using what we&rsquo;ve learned about valid types, we can construct a simple program that creates a socket, and prints its file descriptors or any relevant error:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/socket.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/un.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>main</span>()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> unix_socket, error;
</span></span><span style=display:flex><span>    <span style=color:#75715e>// socket vector, sv, is a vector pointer to two file descriptors
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// representing new sockets for server and client bindings
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>sv[<span style=color:#ae81ff>2</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    unix_socket <span style=color:#f92672>=</span> socket(AF_UNIX, SOCK_DGRAM, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#75715e>// socketpair below is constructed for the OSX variant. The linux variant has a different signature, instead use:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// error = socketpair(AF_UNIX, 0, *sv)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    error <span style=color:#f92672>=</span> socketpair(AF_UNIX, SOCK_DGRAM, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>*</span>sv);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (error <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      printf(<span style=color:#e6db74>&#34;Encountered error: %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, error);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> error;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    printf(<span style=color:#e6db74>&#34;Socket descriptor: %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, unix_socket);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Compiling and running our example can be done by running:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>clang -o socket ./socket.c; ./socket
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Socket descriptor: <span style=color:#ae81ff>3</span>
</span></span></code></pre></div><p>Ok, so we created a socket, and it returned a descriptor, <code>3</code>. What does that mean?</p><p>You are likely familiar with file descriptors 0, 1, 2 if you&rsquo;ve ever redirected output. They are <code>stdin</code>, <code>stdout</code>, and <code>stderr</code>.</p><h2 id=references>References</h2><ol><li><a href=https://beej.us/guide/bgipc/html/multi/index.html>Beej&rsquo;s Guide to Unix IPC</a></li><li><a href=https://man7.org/linux/man-pages/man7/unix.7.html>unix-7 man page</a></li><li><a href=https://man7.org/linux/man-pages/man2/socket.2.html>socket-2 man page</a></li><li><a href=https://en.wikipedia.org/wiki/Unix_domain_socket>unix domain socket wikipedia</a></li><li><a href=https://serverfault.com/questions/124517/what-is-the-difference-between-unix-sockets-and-tcp-ip-sockets>What&rsquo;s the difference between Unix sockets and TCP/IP sockets</a></li><li><a href="https://en.wikipedia.org/wiki/File_descriptor#:~:text=On%20Linux%2C%20the%20set%20of,%2Ffd%2F2%20is%20stderr%20.">File Descriptors</a></li></ol><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/blog/hugo/ aria-label="Previous - Hugo" class="btn btn-primary"><span class=mr-1>←</span>Previous</a></li><li><a href=/blog/homelab/ aria-label="Next - Homelab" class="btn btn-primary">Next<span class=ml-1>→</span></a></li></ul><div class=page-blank><div id=disqus_thread></div><script>(function(){var e=document,t=e.createElement("script");t.src="https://hartje-dot-io.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Linkedin aria-label=Linkedin><a class=text-white target=_blank rel=noopener href=https://linkedin.com/in/ryan-hartje/ aria-label=Linkedin><i class="fab fa-linkedin"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel=noopener href=https://twitter.com/xoxodeadbeef aria-label=Twitter><i class="fab fa-twitter"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"></div></div></div></footer></div><script src=/js/main.min.2ff9ec9f3b75b6ffc95e443dfe22eb8eb61727baff73e04b047119d9566d5409.js integrity="sha256-L/nsnzt1tv/JXkQ9/iLrjrYXJ7r/c+BLBHEZ2VZtVAk=" crossorigin=anonymous></script>
<script defer src=/js/click-to-copy.min.2ed055fa4e6b62a50db07fe160316e9a2adbbcd97879b3686d70c5691d531217.js integrity="sha256-LtBV+k5rYqUNsH/hYDFumirbvNl4ebNobXDFaR1TEhc=" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script></body></html>